<!DOCTYPE html>
<html lang="en-US">
  <head>
    <title>Basic Architecture | abcjs</title><meta name="description" content="JavaScript library for displaying sheet music in a browser."><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="VuePress 2.0.0-beta.7">
    <link rel="preload" href="/abcjs/assets/js/runtime~app.4dfa3f90.js" as="script"><link rel="preload" href="/abcjs/assets/css/styles.80af813e.css" as="style"><link rel="preload" href="/abcjs/assets/js/310.c04019dd.js" as="script"><link rel="preload" href="/abcjs/assets/js/app.f2f640cf.js" as="script">
    <link rel="stylesheet" href="/abcjs/assets/css/styles.80af813e.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="toggle-sidebar-button"><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class=""></path></svg></div><span><a href="/abcjs/" class=""><img class="logo" src="/abcjs//img/abcjs_comp_extended_08.svg" alt="abcjs"><span class="site-name can-hide">abcjs</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><!----></div></header><div class="sidebar-mask"></div><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><section class="sidebar-group"><p class="sidebar-heading">Overview</p><ul class=""><li><!--[--><a href="/abcjs/overview/purpose.html" class="nav-link sidebar-link" aria-label="Purpose"><!--[--><!--]--> Purpose <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/abcjs/overview/examples.html" class="nav-link sidebar-link" aria-label="Examples"><!--[--><!--]--> Examples <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/abcjs/overview/getting-started.html" class="nav-link sidebar-link" aria-label="Getting Started"><!--[--><!--]--> Getting Started <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/abcjs/overview/example-generator.html" class="nav-link sidebar-link" aria-label="Example Generator"><!--[--><!--]--> Example Generator <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/abcjs/overview/abc-notation.html" class="nav-link sidebar-link" aria-label="ABC Music Notation"><!--[--><!--]--> ABC Music Notation <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/abcjs/overview/faq.html" class="nav-link sidebar-link" aria-label="Frequently Asked Questions"><!--[--><!--]--> Frequently Asked Questions <!--[--><!--]--></a><!----><!--]--></li></ul></section><!--]--><!--[--><section class="sidebar-group"><p class="sidebar-heading">Visual</p><ul class=""><li><!--[--><a href="/abcjs/visual/overview.html" class="nav-link sidebar-link" aria-label="Overview (renderAbc)"><!--[--><!--]--> Overview (renderAbc) <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/abcjs/visual/render-abc-options.html" class="nav-link sidebar-link" aria-label="RenderAbc options"><!--[--><!--]--> RenderAbc options <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/abcjs/visual/render-abc-result.html" class="nav-link sidebar-link" aria-label="return value of renderAbc"><!--[--><!--]--> return value of renderAbc <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/abcjs/visual/classes.html" class="nav-link sidebar-link" aria-label="Classes"><!--[--><!--]--> Classes <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/abcjs/visual/click-listener.html" class="nav-link sidebar-link" aria-label="Click Listener"><!--[--><!--]--> Click Listener <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/abcjs/visual/dragging.html" class="nav-link sidebar-link" aria-label="Selecting and Dragging Elements"><!--[--><!--]--> Selecting and Dragging Elements <!--[--><!--]--></a><!----><!--]--></li></ul></section><!--]--><!--[--><section class="sidebar-group"><p class="sidebar-heading">Audio</p><ul class=""><li><!--[--><a href="/abcjs/audio/synthesized-sound.html" class="nav-link sidebar-link" aria-label="Synthesized Sound"><!--[--><!--]--> Synthesized Sound <!--[--><!--]--></a><!----><!--]--></li></ul></section><!--]--><!--[--><section class="sidebar-group"><p class="sidebar-heading">Animation</p><ul class=""><li><!--[--><a href="/abcjs/animation/timing-callbacks.html" class="nav-link sidebar-link" aria-label="Timing Callbacks"><!--[--><!--]--> Timing Callbacks <!--[--><!--]--></a><!----><!--]--></li></ul></section><!--]--><!--[--><section class="sidebar-group"><p class="sidebar-heading">Interactive</p><ul class=""><li><!--[--><a href="/abcjs/interactive/interactive-editor.html" class="nav-link sidebar-link" aria-label="Interactive Editor"><!--[--><!--]--> Interactive Editor <!--[--><!--]--></a><!----><!--]--></li></ul></section><!--]--><!--[--><section class="sidebar-group"><p class="sidebar-heading">Analysis</p><ul class=""><li><!--[--><a href="/abcjs/analysis/tune-book.html" class="nav-link sidebar-link" aria-label="Tune Book"><!--[--><!--]--> Tune Book <!--[--><!--]--></a><!----><!--]--></li></ul></section><!--]--><!--[--><section class="sidebar-group"><p class="sidebar-heading">Deprecated</p><ul class=""><li><!--[--><a href="/abcjs/deprecated/deprecated-api.html" class="nav-link sidebar-link" aria-label="Deprecated API Calls"><!--[--><!--]--> Deprecated API Calls <!--[--><!--]--></a><!----><!--]--></li></ul></section><!--]--><!--[--><section class="sidebar-group"><p class="sidebar-heading active">Developers</p><ul class=""><li><!--[--><a href="/abcjs/developers/pull-requests.html" class="nav-link sidebar-link" aria-label="Pull Requests"><!--[--><!--]--> Pull Requests <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/abcjs/developers/basic-architecture.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-link active" aria-label="Basic Architecture"><!--[--><!--]--> Basic Architecture <!--[--><!--]--></a><ul class="sidebar-sub-headers"><li><!--[--><a aria-current="page" href="/abcjs/developers/basic-architecture.html#docker" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/abcjs/developers/basic-architecture.html#building-locally" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="Building locally"><!--[--><!--]--> Building locally <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/abcjs/developers/basic-architecture.html#greasemonkey" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="Greasemonkey"><!--[--><!--]--> Greasemonkey <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/abcjs/developers/basic-architecture.html#testing" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="Testing"><!--[--><!--]--> Testing <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/abcjs/developers/basic-architecture.html#font-info" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="Font Info"><!--[--><!--]--> Font Info <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/abcjs/developers/releasing.html" class="nav-link sidebar-link" aria-label="Releasing"><!--[--><!--]--> Releasing <!--[--><!--]--></a><!----><!--]--></li></ul></section><!--]--><!--[--><section class="sidebar-group"><p class="sidebar-heading">Upgrading</p><ul class=""><li><!--[--><a href="/abcjs/upgrading/release-notes.html" class="nav-link sidebar-link" aria-label="Release Notes"><!--[--><!--]--> Release Notes <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/abcjs/upgrading/midijs.html" class="nav-link sidebar-link" aria-label="MIDI.JS Usage"><!--[--><!--]--> MIDI.JS Usage <!--[--><!--]--></a><!----><!--]--></li></ul></section><!--]--><!--]--></ul><!--[--><!--]--></aside><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="basic-architecture"><a class="header-anchor" href="#basic-architecture">#</a> Basic Architecture</h1><p>There are two forms of this library: the npm form and a minimized form for non-npm users.</p><p>When testing abcjs changes locally, there is no build step required. A handy way to test is to run:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>npm link
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>On this folder, and</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>npm link abcjs
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>In a test application. Then any changes made to the abcjs code will automatically be picked up by that test application&#39;s webpack.</p><h2 id="docker"><a class="header-anchor" href="#docker">#</a> Docker</h2><p>There are docker files included so that npm can be run without installing it. This only applies to someone who wants to keep all their development tools separate on their computer. If you have nodejs installed then you can ignore this.</p><p>If you do want to build without development tools installed, but you do have Docker installed, put this in your profile:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function-name function">npm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token assign-left variable">CMD</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${1<span class="token operator">:</span> }</span> <span class="token variable">${2<span class="token operator">:</span> }</span> <span class="token variable">${3<span class="token operator">:</span> }</span>&quot;</span> docker-compose up
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Then from the root folder you can use <code>npm</code> like normal. Note that this won&#39;t work if you are from any other folder.</p><h2 id="building-locally"><a class="header-anchor" href="#building-locally">#</a> Building locally</h2><p>To build the library so that it can be included with a <code>&lt;script&gt;</code> tag, there are some options:</p><p>To build everything:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> run build
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>This takes a little while and is probably building more things than you want.</p><p>If you want to build a version that is convenient to debug:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> run build:basic
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>Then include the file <code>dist/abcjs-basic.js</code>.</p><p>To build the same code as minimized for distribution:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> run build:basic-min
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>And include the file <code>disst/abcjs-basic-min.js</code>.</p><p>If you want to keep the version numbering on the files (so that different versions are easy to keep straight), after building either <code>build:basic</code> or <code>build:basic-min</code> run the script:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> run build:copy-output
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="greasemonkey"><a class="header-anchor" href="#greasemonkey">#</a> Greasemonkey</h2><p>There used to be a version of the library for Greasemonkey but that has been discontinued. If you want a Greasemonkey version, do this:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">cat</span> src/plugin/greasemonkey.js bin/abcjs_plugin_5.12.0-min.js <span class="token operator">&gt;</span> bin/abcjs_plugin_5.12.0.user.js
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="testing"><a class="header-anchor" href="#testing">#</a> Testing</h2><p>There are hundreds of test files that are stored outside of this repository. If you wish to run the unit tests, please contact <a href="https://paulrosen.net/contact-me/" target="_blank" rel="noopener noreferrer">Paul Rosen<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> for more information.</p><p>The files in the folder <code>test</code> contain a number of functions that receive an ABC formatted string and output an easy to read dump of the resulting objects.</p><p>These objects are at various stages though the process of handling the ABC. The stages are:</p><ol><li>After parsing the ABC string into an internal object.</li><li>After laying out the placement of all elements.</li><li>After putting all elements in the time that they should sound.</li><li>After creating a set of MIDI instructions.</li></ol><p>The method of unit testing is to run all of the test files through the various linters and save the output. Then, after making changes to the code, run the test files through again and compare the output to the original output to understand the effect of the changes.</p><p>Here&#39;s an example of how to call the linting functions:</p><pre><code>import abcjs from &#39;abcjs/test&#39;;
doTest(abcString) {
	const tuneBook = new abcjs.TuneBook(abcString);
	const abcParser = new abcjs.parse.Parse();
	const parserLint = new abcjs.test.ParserLint();
	const div = document.getElementById(&quot;comparison-engraving&quot;);
	const engraverController = new abcjs.write.EngraverController(div,
	     {add_classes: true, staffwidth: 800, staffheight: 400});

	tuneBook.tunes.forEach((item) =&gt; {
		abcParser.parse(item.abc);
		const tune = abcParser.getTune();
		const warnings = abcParser.getWarnings();
		const lint1 = parserLint.lint(tune, warnings);

		engraverController.engraveABC(tune);
		const output = abcjs.test.verticalLint([tune]);
		const lint2 = output.join(&quot;\n&quot;);

		const sequence = abcjs.midi.sequence(tune);
		const lint3 = abcjs.test.midiSequencerLint(sequence);

		const midi = abcjs.midi.flatten(sequence);
		const lint4 = abcjs.test.midiLint(midi);

		console.log(&quot;PARSER OUTPUT&quot;);
		console.log(lint1);
		console.log(&quot;ENGRAVER OUTPUT&quot;);
		console.log(lint2);
		console.log(&quot;MIDI SEQUENCE OUTPUT&quot;);
		console.log(lint3);
		console.log(&quot;MIDI OUTPUT&quot;);
		console.log(lint4);
	});
}
</code></pre><h2 id="font-info"><a class="header-anchor" href="#font-info">#</a> Font Info</h2><p>The glyphs in <code>src/write/abc_glyphs.js</code> are generated using the files in the <code>font_generator</code> folder.</p><p>You can see all the glyphs by loading this file in the browser: <code>abcjs/font_generator/font_gen.html</code>.</p><p>You can play with the glyphs to help you modify them in this file: <code>abcjs/font_generator/font_editor.html</code></p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">1/3/2021, 4:33:22 PM</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: paul@paulrosen.net">Paul Rosen</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/abcjs/developers/pull-requests.html" class="nav-link" aria-label="Pull Requests"><!--[--><!--]--> Pull Requests <!--[--><!--]--></a></span><span class="next"><a href="/abcjs/developers/releasing.html" class="nav-link" aria-label="Releasing"><!--[--><!--]--> Releasing <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main></div><!----><!--]--></div>
    <script src="/abcjs/assets/js/runtime~app.4dfa3f90.js" defer></script><script src="/abcjs/assets/js/310.c04019dd.js" defer></script><script src="/abcjs/assets/js/app.f2f640cf.js" defer></script>
  </body>
</html>
